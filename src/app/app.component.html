<mat-toolbar color="primary">
  <img src="icons/626.ico" alt="Logo" class="app-logo">
  <span>Gerador de Campo Harmônico</span>
</mat-toolbar>

<div class="main-container">
  <div class="top-section">
    <!-- Coluna da Esquerda: Geração -->
    <div class="column left-column">
      <!-- Seção de Controles -->
      <mat-card class="card">
        <mat-card-header>
          <mat-card-title class="card-title">
            Defina a Tonalidade
            <mat-icon
              class="help-icon"
              matTooltip="Ajuda"
              (click)="
                openHelpDialog('Defina a Tonalidade', 'Texto explicativo sobre a tonalidade...')
              "
              >info</mat-icon
            >
          </mat-card-title>
        </mat-card-header>
        <mat-card-content class="controls-container">
          <mat-form-field appearance="fill">
            <mat-label>Nota Raiz</mat-label>
            <mat-select [(ngModel)]="selectedNote" [disabled]="isHarmonicFieldLocked">
              <mat-option *ngFor="let note of notes" [value]="note">{{ note }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-button-toggle-group
            [(ngModel)]="useFlats"
            (ngModelChange)="onAccidentalChange()"
            name="accidentals"
            aria-label="Acidentes Musicais"
            [disabled]="isHarmonicFieldLocked"
          >
            <mat-button-toggle [value]="false">#</mat-button-toggle>
            <mat-button-toggle [value]="true">b</mat-button-toggle>
          </mat-button-toggle-group>

          <mat-button-toggle-group
            [(ngModel)]="selectedMode"
            name="tonalidade"
            aria-label="Tonalidade"
            [disabled]="isHarmonicFieldLocked"
          >
            <mat-button-toggle value="major">Maior</mat-button-toggle>
            <mat-button-toggle value="minor">Menor</mat-button-toggle>
          </mat-button-toggle-group>
        </mat-card-content>
        <mat-card-actions>
          <button
            *ngIf="!isHarmonicFieldLocked"
            mat-raised-button
            color="primary"
            (click)="generateHarmonicField()"
          >
            Gerar Campo Harmônico
          </button>
          <button
            *ngIf="isHarmonicFieldLocked"
            mat-raised-button
            color="accent"
            (click)="resetHarmonicField()"
          >
            Novo Campo Harmônico
          </button>
        </mat-card-actions>
      </mat-card>

      <!-- Seção do Campo Harmônico -->
      <mat-card class="card harmonic-field-card">
        <mat-card-header>
          <div *ngIf="!isHarmonicFieldLocked">
            <mat-card-title class="card-title">
              Campo Harmônico
              <mat-icon
                class="help-icon"
                matTooltip="Ajuda"
                (click)="
                  openHelpDialog('Campo Harmônico', 'Texto explicativo sobre campo harmônico...')
                "
                >info</mat-icon
              >
            </mat-card-title>
          </div>
          <div *ngIf="isHarmonicFieldLocked">
            <mat-card-title>
              Campo Harmônico de {{ selectedNote.split('/')[0] }}
              {{ selectedMode === 'major' ? 'Maior' : 'Menor' }}
            </mat-card-title>
            <mat-card-subtitle>Clique em um acorde para visualizar</mat-card-subtitle>
          </div>
        </mat-card-header>
        <mat-card-content>
          <div *ngIf="!isHarmonicFieldLocked" class="placeholder">
            Gere um campo harmônico primeiro.
          </div>
          <div *ngIf="isHarmonicFieldLocked">
            <div
              *ngFor="let chord of harmonicField"
              class="chord-display"
              [ngClass]="chord.type"
              (click)="selectChordForPiano(chord)"
              style="cursor: pointer"
            >
              <span class="chord-name">{{ chord.degree }}: {{ chord.name }}</span>
              <span class="chord-notes">{{ chord.notes }}</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Seção da Escala -->
      <mat-card class="card">
        <mat-card-header>
          <div *ngIf="!isHarmonicFieldLocked">
            <mat-card-title class="card-title">
              Escala
              <mat-icon
                class="help-icon"
                matTooltip="Ajuda"
                (click)="openHelpDialog('Escala', 'Texto explicativo sobre escala...')"
                >info</mat-icon
              >
            </mat-card-title>
          </div>
          <div *ngIf="isHarmonicFieldLocked">
            <mat-card-title>
              Escala de {{ selectedNote.split('/')[0] }}
              {{ selectedMode === 'major' ? 'Maior' : 'Menor' }}
            </mat-card-title>
            <mat-card-subtitle>Clique em uma nota para ouvir</mat-card-subtitle>
          </div>
        </mat-card-header>
        <mat-card-content>
          <div *ngIf="!isHarmonicFieldLocked" class="placeholder">
            Gere um campo harmônico primeiro.
          </div>
          <div *ngIf="isHarmonicFieldLocked" class="scale-display">
            <div *ngFor="let note of scaleNotesWithDegrees" class="scale-note-container">
              <span class="scale-degree">{{ note.degree }}</span>
              <span class="scale-note" (click)="playNote(note.note)">{{ note.displayName }}</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Coluna da Direita: Gerador de Acordes -->
    <div class="column right-column">
      <app-chord-generator (chordGenerated)="onChordGenerated($event)"></app-chord-generator>
      <app-harmonic-progression
        (chordPlayedInProgression)="onChordPlayedInProgression($event)"
      ></app-harmonic-progression>
    </div>
  </div>

  <!-- Seção Inferior: Visualização do Acorde -->
  <div class="bottom-section">
    <mat-card class="card">
      <mat-card-header>
        <mat-card-title class="card-title">
          Visualização do Acorde
          <mat-icon
            class="help-icon"
            matTooltip="Ajuda"
            (click)="
              openHelpDialog(
                'Visualização do Acorde',
                'Texto explicativo sobre visualização do acorde...'
              )
            "
            >info</mat-icon
          >
        </mat-card-title>
        <mat-card-subtitle class="chord-visualization-name">{{
          selectedChordName
        }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content class="piano-container">
        <app-piano
          [notesToHighlight]="currentPianoHighlightNotes"
          [useFlats]="useFlats"
        ></app-piano>
      </mat-card-content>
    </mat-card>
  </div>
</div>
