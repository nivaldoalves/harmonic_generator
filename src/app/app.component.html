<mat-toolbar color="primary">
  <span>Gerador de Campo Harmônico</span>
</mat-toolbar>

<div class="main-container">
  <div class="top-section">
    <!-- Coluna da Esquerda: Geração -->
    <div class="column left-column">
      <!-- Seção de Controles -->
      <mat-card class="card">
        <mat-card-header>
          <mat-card-title>Defina a Tonalidade</mat-card-title>
        </mat-card-header>
        <mat-card-content class="controls-container">
          <mat-form-field appearance="fill">
            <mat-label>Nota Raiz</mat-label>
            <mat-select [(ngModel)]="selectedNote">
              <mat-option *ngFor="let note of notes" [value]="note">{{ note }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-button-toggle-group
            [(ngModel)]="useFlats"
            (ngModelChange)="onAccidentalChange()"
            name="accidentals"
            aria-label="Acidentes Musicais"
          >
            <mat-button-toggle [value]="false">#</mat-button-toggle>
            <mat-button-toggle [value]="true">b</mat-button-toggle>
          </mat-button-toggle-group>

          <mat-button-toggle-group
            [(ngModel)]="selectedMode"
            name="tonalidade"
            aria-label="Tonalidade"
          >
            <mat-button-toggle value="major">Maior</mat-button-toggle>
            <mat-button-toggle value="minor">Menor</mat-button-toggle>
          </mat-button-toggle-group>
        </mat-card-content>
        <mat-card-actions>
          <button mat-raised-button color="primary" (click)="generateHarmonicField()">
            Gerar Campo Harmônico
          </button>
        </mat-card-actions>
      </mat-card>

      <!-- Seção do Campo Harmônico -->
      <mat-card class="card harmonic-field-card">
        <mat-card-header>
          <mat-card-title
            >2. Campo Harmônico de {{ selectedNote.split('/')[0] }}
            {{ selectedMode === 'major' ? 'Maior' : 'Menor' }}</mat-card-title
          >
          <mat-card-subtitle>Clique em um acorde para visualizar</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div *ngIf="harmonicField.length === 0" class="placeholder">
            Gere um campo harmônico primeiro.
          </div>
          <div
            *ngFor="let chord of harmonicField"
            class="chord-display"
            [ngClass]="chord.type"
            (click)="selectChordForPiano(chord)"
            style="cursor: pointer"
          >
            <span class="chord-name">{{ chord.degree }}: {{ chord.name }}</span>
            <span class="chord-notes">{{ chord.notes }}</span>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Seção da Escala -->
      <mat-card class="card">
        <mat-card-header>
          <mat-card-title>Escala de {{ selectedNote.split('/')[0] }} {{ selectedMode === 'major' ? 'Maior' : 'Menor' }}</mat-card-title>
          <mat-card-subtitle>Clique em uma nota para ouvir</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div *ngIf="scaleNotes.length === 0" class="placeholder">
            Gere um campo harmônico para ver a escala.
          </div>
          <div class="scale-display">
            <div
              *ngFor="let note of scaleNotesWithDegrees"
              class="scale-note-container"
            >
              <span class="scale-degree">{{ note.degree }}</span>
              <span class="scale-note" (click)="playNote(note.note)">
                {{ note.displayName }}
              </span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Coluna da Direita: Gerador de Acordes -->
    <div class="column right-column">
      <app-chord-generator (chordGenerated)="onChordGenerated($event)"></app-chord-generator>
    </div>
  </div>

  <!-- Seção Inferior: Visualização do Acorde -->
  <div class="bottom-section">
    <mat-card class="card">
      <mat-card-header>
        <mat-card-title>Visualização do Acorde</mat-card-title>
        <mat-card-subtitle class="chord-visualization-name">{{ selectedChordName }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content class="piano-container">
        <app-piano [notesToHighlight]="selectedChordNotes" [useFlats]="useFlats"></app-piano>
      </mat-card-content>
    </mat-card>
  </div>
</div>